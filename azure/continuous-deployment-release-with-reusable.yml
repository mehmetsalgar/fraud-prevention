name: Continuous Deployment Release with Reusable
pool:
  vmImage: ubuntu-latest

variables:
- group: HELM_VARIABLES
- group: DOCKER_VARIABLES

resources:
  pipelines:
    - pipeline: Build
      source: Build-with-Reusable
      trigger:
        enabled: true
        branches:
          include:
            - ref/heads/release/*
          exclude:
            - ref/heads/master
            - ref/heads/development
            - ref/heads/feature/*
            - ref/heads/bugfix/*
            - ref/heads/hotfix/*
  repositories:
    - repository: fsm-akka-azure-pipelines
      type: github
      name: mehmetsalgar/fsm-akka-azure-pipelines
      endpoint: mehmetsalgar
    - repository: ServiceRepository
      type: github
      endpoint: mehmetsalgar
      name: mehmetsalgar/fraud-prevention
      ref: $(Build.SourceBranch)

stages:
  - stage: Build
    displayName: Build
    jobs:
    - template: continuous-deployment-with-environment.yml@fsm-akka-azure-pipelines
      parameters:
        repoName: 'fraud-prevention'
        branchName: $(Build.SourceBranch)
        umbrellaChartBaseName: 'master'
        infrastructureBaseBranchName: 'master'
        valueFile: "value-release"
